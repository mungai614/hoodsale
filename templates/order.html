<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Orders - ClothingStore Admin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container">
    <a class="navbar-brand" href="index.html">ClothingStore Admin</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#adminNavbar" aria-controls="adminNavbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="adminNavbar">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="admin.html">Dashboard</a></li>
        <li class="nav-item"><a class="nav-link active" aria-current="page" href="orders.html">Orders</a></li>
        <li class="nav-item"><a class="nav-link" href="index.html">Shop Front</a></li>
        <li class="nav-item"><a class="nav-link" href="login.html" onclick="logout()">Logout</a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="container my-5">
  <h1>Orders</h1>
  <p>Review all customer orders here.</p>

  <div class="table-responsive">
    <table class="table table-striped table-bordered align-middle">
      <thead class="table-dark">
        <tr>
          <th>Order ID</th>
          <th>Customer Email</th>
          <th>Date</th>
          <th>Items</th>
          <th>Total ($)</th>
        </tr>
      </thead>
      <tbody id="orders-table-body">
        <!-- Orders will be injected here -->
      </tbody>
    </table>
  </div>
</div>

<script>
  // Admin check
  const loggedInUser = JSON.parse(localStorage.getItem("loggedInUser"));
  if (!loggedInUser || loggedInUser.email !== "admin@example.com") {
    alert("Access denied. Admins only.");
    window.location.href = "login.html";
  }

  // Logout function
  function logout() {
    localStorage.removeItem("loggedInUser");
  }

  const products = JSON.parse(localStorage.getItem("products")) || [];
  const orders = JSON.parse(localStorage.getItem("orders")) || [];

  const tbody = document.getElementById("orders-table-body");

  if (orders.length === 0) {
    const tr = document.createElement("tr");
    const td = document.createElement("td");
    td.colSpan = 5;
    td.classList.add("text-center");
    td.textContent = "No orders found.";
    tr.appendChild(td);
    tbody.appendChild(tr);
  } else {
    orders.forEach(order => {
      const tr = document.createElement("tr");

      // Order ID
      const tdId = document.createElement("td");
      tdId.textContent = order.id;
      tr.appendChild(tdId);

      // Customer Email
      const tdEmail = document.createElement("td");
      tdEmail.textContent = order.customerEmail;
      tr.appendChild(tdEmail);

      // Date
      const tdDate = document.createElement("td");
      tdDate.textContent = new Date(order.date).toLocaleString();
      tr.appendChild(tdDate);

      // Items
      const tdItems = document.createElement("td");
      const itemList = order.items.map(item => {
        const product = products.find(p => p.id === item.productId);
        return `${product ? product.name : 'Unknown'} x ${item.quantity}`;
      }).join(", ");
      tdItems.textContent = itemList;
      tr.appendChild(tdItems);

      // Total Price
      const totalPrice = order.items.reduce((sum, item) => {
        const product = products.find(p => p.id === item.productId);
        return sum + (product ? product.price * item.quantity : 0);
      }, 0);
      const tdTotal = document.createElement("td");
      tdTotal.textContent = totalPrice.toFixed(2);
      tr.appendChild(tdTotal);

      tbody.appendChild(tr);
    });
  }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
